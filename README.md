# âœ¨ï¸ æ¦‚è¿°
one-apiæ˜¯ä¸€ä¸ªæ²¡æœ‰ä»»ä½•ç¬¬ä¸‰æ–¹ä¾èµ–çš„æ•°æ®åº“æ“ä½œå·¥å…·ã€‚\
æŠŠå®ƒé›†æˆåˆ°webæ¡†æ¶å¦‚springbooté‡Œï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªAPIæ¥å£å®ç°æ‰€æœ‰è¡¨çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚\
å‚æ•°å¯ä»¥ä½¿ç”¨é©¼å³°é£æ ¼ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰åˆ«åã€‚\
èƒ½å®ç°å¤æ‚çš„æŸ¥è¯¢ï¼Œä¹Ÿæ”¯æŒä¸»å­è¡¨åˆ†é¡µã€‚\
åŠŸèƒ½å¼ºå¤§ï¼Œå†…ç½®äº†ä¸°å¯Œçš„æ‰©å±•ç‚¹ã€‚\
å®ƒçš„å®ç°é€»è¾‘æ˜¯DSL -> AST -> SQLï¼Œç»“æ„ç®€æ´ï¼Œéå¸¸å®¹æ˜“æ‰©å±•å’Œé­”æ”¹ã€‚

-----

# ğŸ“• èƒŒæ™¯
åœ¨å¼€å‘ä¸šåŠ¡ç³»ç»Ÿæ—¶ï¼Œå¾€å¾€æ–°å¢ä¸€å¼ è¡¨ï¼Œè‡³å°‘è¦å†™4ä¸ªæ¥å£ï¼Œå¢ã€åˆ ã€æ”¹ã€æŸ¥ï¼Œå¯èƒ½è¿˜è¦å¤„ç†ç›¸ä¼¼çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚æŠŠmaleè½¬ä¸ºç”·ï¼Œfemaleè½¬ä¸ºå¥³ï¼ŒæŠŠuserIdè½¬ä¸ºuserNameï¼Œæ‹¼æ¥æŸ¥è¯¢æ¡ä»¶æ—¶è¦åˆ¤æ–­å‚æ•°æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå‚æ•°æ ¼å¼ä¸å¯¹ï¼Œè¿˜è¦è¿›è¡Œç±»å‹è½¬æ¢ç­‰ç­‰ï¼Œè¿™äº›é—®é¢˜å‡å°‘äº†æˆ‘ä»¬æ‘¸é±¼çš„æ—¶é—´ã€‚\
one-apiå°±æ˜¯æƒ³é€šè¿‡ä¸€ä¸ªæ¥å£å°½é‡åšæ›´å¤šçš„äº‹æƒ…ï¼Œæ–°å¢ä¸€å¼ è¡¨è‡³å°‘æ™®é€šçš„crud4ä¸ªæ¥å£ä¸éœ€è¦å†™äº†ï¼Œè€Œä¸”ä¸€æ¬¡è¯·æ±‚å¯ä»¥è·å–å¤šå¼ è¡¨çš„æ•°æ®ï¼Œå°‘äº†å¾ˆå¤šå·¥ä½œé‡ã€‚

----

# â˜€ï¸ æ”¯æŒåŠŸèƒ½
- 1ã€ä¸€ä¸ªæ¥å£æ”¯æŒæ‰€æœ‰è¡¨çš„å¢åˆ æ”¹æŸ¥ï¼Œç®€å•ä¸šåŠ¡æ¥å£æ— éœ€å†å†™
- 2ã€æ— ä»»ä½•ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ŒåŒ…ä½“ç§¯å¾ˆå°ï¼Œå¯¹ç°æœ‰ç³»ç»Ÿä¸ä¼šé€ æˆä»»ä½•å½±å“ï¼Œä¸€åˆ†é’Ÿå†…å¯å®Œæˆé›†æˆå·¥ä½œ
- 3ã€æ”¯æŒåˆ†é¡µæŸ¥è¯¢ï¼Œå¤šè¡¨å…³è”æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸°å¯Œï¼Œæ”¯æŒlikeã€inã€betweenã€is nullã€=ç­‰æ¡ä»¶ï¼Œæ”¯æŒæ‹¬å·ï¼Œæ”¯æŒorè¿æ¥
- 4ã€æ”¯æŒæ‰¹é‡åˆ é™¤ã€æ›´æ–°å’Œæ’å…¥ï¼Œæ›´æ–°å¯è®¾ç½®å¤šä¸ªæ¡ä»¶ï¼›æ‰¹é‡æ’å…¥ä¸ºæ•°æ®åº“æ”¯æŒçš„æ‰¹é‡sqlï¼Œæ•ˆç‡é«˜
- 4ã€æ”¯æŒçš„æ‰©å±•åŠŸèƒ½å¾ˆå¤šï¼šåˆ«åè®¾ç½®ã€å­—å…¸ç¿»è¯‘ã€ä¸»é”®ç”Ÿæˆã€è‡ªåŠ¨å¡«å……ã€é€»è¾‘åˆ é™¤ã€sqlæ‰“å°ã€æ•°æ®æƒé™ç­‰
- 5ã€æ”¯æŒå¤šæ•°æ®æºï¼Œä¸€ä¸ªæ•°æ®æºå¯¹åº”ä¸€ä¸ªæ¥å£
- 6ã€å®ç°çš„é€»è¾‘ä¸ºDSL->AST->SQLï¼Œè¿™æ ·çš„ç»“æ„è®¾è®¡æ›´å®¹æ˜“é­”æ”¹
- 7ã€ç›®å‰æ”¯æŒmysqlå’Œoracleï¼Œå…¶ä»–æ•°æ®åº“æ­£åœ¨é€‚é…ä¸­â€¦â€¦

# â˜€ï¸ æ”¯æŒæ‰©å±•ç‚¹
- åˆ«åè®¾ç½®
- å­—å…¸ç¿»è¯‘
- ä¸»é”®ç”Ÿæˆ
- è‡ªåŠ¨å¡«å……
- é€»è¾‘åˆ é™¤
- sqlæ‰“å°
- æ•°æ®æƒé™
- æ•°æ®é¢„çƒ­
---

# ä½¿ç”¨è¯´æ˜
> é›†æˆwebæ¡†æ¶ï¼Œä»¥springbootæ¥ä¸¾ä¾‹
- pomå¼•å…¥
    ```
    <dependency>
         <groupId>com.yz</groupId>
         <artifactId>one-api</artifactId>
         <version>1.0-SNAPSHOT</version>
    </dependency>
    ```
  - æ–°å»ºæ¥å£ 
    ```
    @RequestMapping("/one/api")
    @RestController
    public class OneApi implements InitializingBean {

      @Autowired
      private DataSource dataSource;
      private AutoApiConfig oneApiConfig;

      @PostMapping()
      public ResultWrapper one(@RequestBody Map<String, Object> map) throws SQLException {
          RoutingExecutor routingExecutor = oneApiConfig.getParseExecutor();
          ResultWrapper execute = routingExecutor.execute(map);
          return execute;
      }

      @Override
      public void afterPropertiesSet() throws Exception {
          //é…ç½®
          oneApiConfig = new AutoApiConfig(dataSource);
          //è®¾ç½®æ‰©å±•ç‚¹
          oneApiConfig.setInterceptor(new TestInterceptor());
          oneApiConfig.postProcess();
      }

    ```
- æ¥å£è°ƒç”¨
> æŸ¥è¯¢
```
//å…¥å‚
{
   "User":{
     "(id(":38710,
     "name@|":"like %le%",
     "|createDate@":"between 2012-01-01 11-11-11,2012-03-01",
     "&type@)": "in 1,2,3",
     "@order":["name asc", "createDate desc"],
     "age": 123,
     "@page": 0,
     "@size": 3,
     "userDetails":{
         "userId@":"/User/id"   
     }
   },
   "moment":{
       "userId@": "/user/id"      
   }
}
//è¿”å›æ•°æ®
```
> æ–°å¢
```
//å…¥å‚
{
    "user":[{
        "age": 5,
        "name": "leo"
    },{
        "name": "lucy",
        "age": 3
    }]
}
```
> æ›´æ–°
```
//å…¥å‚
{
    "user":[{
        "id": 34,
        "name": 234
    },{
        "name": "leo",
        "type@": "3"
    }]
}
```
> åˆ é™¤
```
//å…¥å‚
{
    "user":[123, 234]
}
```

# ğŸ™æ„Ÿè°¢
é¡¹ç›®ä¸­ä½¿ç”¨äº†å¾ˆå¤šmybaitsçš„æºç ï¼Œæ„Ÿè°¢ğŸ™ï¼Œä¸å¾—ä¸ç§°èµmybatiså†™çš„å¾ˆä¼˜é›…ã€‚


